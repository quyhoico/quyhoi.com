(function($){$.fn.slideshow=function(options){var slides=$(this);var settings=$.extend({randomize:true,slideDuration:6000,fadeDuration:1000,animate:true,pauseOnTabBlur:true,enableLog:false,slideElementClass:'slide',slideshowId:'slideshow'},options);if(settings.enableLog==false){console.log=function(){};}
if(settings.randomize==true){var slidesDOM=slides[0];for(var i=slidesDOM.children.length;i>=0;i--){slidesDOM.appendChild(slidesDOM.children[Math.random()*i|0]);}}
$('<div id="'+settings.slideshowId+'"></div>').insertBefore(slides);var paused=false;var slideshow=$('#'+settings.slideshowId);var slideTimeDelta=0;var resumeStartTime=0;var resumeTimer;if(settings.animate==true){var cssAnimationDuration=settings.slideDuration+settings.fadeDuration;}else{slides.find('.'+settings.slideElementClass+' span.animate').removeClass('animate');var cssAnimationDuration=0;}
console.log('Slideshow initialized.');slides.find('.'+settings.slideElementClass+':first span.animate').addClass('active').css('animation-duration',cssAnimationDuration+'ms')
slides.find('.'+settings.slideElementClass+':first').prependTo(slideshow);var currentSlideStartTime=Date.now();slidesInterval=setInterval(slideRefresh,settings.slideDuration);console.log('Slideshow started.');if(settings.pauseOnTabBlur==true){$(window).focus(function(){console.log('Window gained focus.');if(paused==true){console.log('Resuming slideshow.');resumeStartTime=Date.now();paused=false;$('#'+settings.slideshowId+' span.active:last').removeClass('paused');resumeTimer=setTimeout(function(){slideTimeDelta=0;slideRefresh();slidesInterval=setInterval(slideRefresh,settings.slideDuration);},settings.slideDuration-slideTimeDelta);}}).blur(function(){paused=true;console.log('Window lost focus, slideshow paused.');if(slideTimeDelta!=0){var timeSinceLastPause=Date.now()-resumeStartTime;slideTimeDelta=slideTimeDelta+timeSinceLastPause;console.log('Time since last pause within this slide: '+timeSinceLastPause+' ms');}else{slideTimeDelta=Date.now()-currentSlideStartTime;}
console.log('Current slide at '+slideTimeDelta+' ms.');$('#'+settings.slideshowId+' span.active:first').addClass('paused');clearInterval(slidesInterval);clearTimeout(resumeTimer);});}
function slideRefresh(){console.log('Slide refresh triggered.');currentSlideStartTime=Date.now();var slideshowDOM=slideshow[0];if(slideshowDOM.children.length==0){console.log('There are no slides in the slideshow.');slides.find('.'+settings.slideElementClass+':first').prependTo(slideshow);}else{slides.find('.'+settings.slideElementClass+':first').prependTo(slideshow);var slideElement='#'+settings.slideshowId+' .'+settings.slideElementClass;$(slideElement+':first span.animate').addClass('active').css('animation-duration',cssAnimationDuration+'ms');;$(slideElement+':last').fadeOut(settings.fadeDuration,function(){$(slideElement+':last span.animate').removeClass('active').css('animation-duration','0ms');;$(slideElement+':last').appendTo(slides);slides.find('.'+settings.slideElementClass).show(0);});}}};}(jQuery));